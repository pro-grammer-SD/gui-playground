<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GUI Playground</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- UMD version exposes lucide globally -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="max-w-4xl mx-auto p-6">
      <div
        class="bg-yellow-200 text-yellow-900 p-4 rounded mb-6 flex items-center gap-2"
      >
        <i data-lucide="alert-triangle"></i>
        <span>Tkinter removed. Supported: PySide6, PyQt6, Kivy, Flet</span>
      </div>

      <div class="bg-white p-6 rounded shadow-md">
        <h2 class="text-xl font-bold mb-2">Write Python GUI code:</h2>
        <textarea id="code" rows="12" class="w-full p-2 border rounded mb-4">
from PySide6.QtWidgets import QApplication, QLabel, QPushButton, QVBoxLayout, QWidget
import sys

app = QApplication(sys.argv)
window = QWidget()
layout = QVBoxLayout()
label = QLabel("Hello!")
button = QPushButton("Click me")
button.clicked.connect(lambda: label.setText("Clicked!"))
layout.addWidget(label)
layout.addWidget(button)
window.setLayout(layout)
window.show()
sys.exit(app.exec())
    </textarea
        >

        <button
          id="runBtn"
          class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        >
          <i data-lucide="play-circle"></i> Run
        </button>

        <div id="vnc_container" class="mt-6"></div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        lucide.createIcons();

        const runBtn = document.getElementById("runBtn");
        runBtn.addEventListener("click", async () => {
          const code = document.getElementById("code").value;
          const res = await fetch("/run", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code }),
          });
          const data = await res.json();
          const port = data.vnc_port;
          const iframe = document.createElement("iframe");
          iframe.width = "800";
          iframe.height = "600";
          iframe.src = `/noVNC/vnc.html?host=${window.location.hostname}&port=${port}`;
          document.getElementById("vnc_container").innerHTML = "";
          document.getElementById("vnc_container").appendChild(iframe);
        });
      });
    </script>
  </body>
</html>
